<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Tabata Timer</title>
<style>
  :root{
    --bg-work:#000;
    --bg-rest:#8b1e5d;
    --bg-pause:#87ceeb;

    --letters-work:#60a5fa;
    --nums-rest:#facc15;
    --nums-pause:#a855f7;

    --work1: rgba(34,197,94,.95);
    --work2: rgba(34,197,94,.65);
    --rest1: rgba(239,68,68,.95);
    --rest2: rgba(239,68,68,.65);

    --fab:#60a5fa;
  }

  body{
    margin:0; font-family:sans-serif; text-align:center; color:white;
    background:var(--bg-work); transition:background .2s ease;
  }
  .progress-full{
    position:fixed; left:0; right:0; bottom:0; z-index:0;
    height:6vh;
    background:linear-gradient(to top,var(--work1),var(--work2));
    transition:height .2s linear;
  }
  .rep-btn{
    position:fixed; top:8px; right:10px; background:#333; color:#bbb;
    font-size:12px; padding:4px 8px; border-radius:12px; z-index:10;
  }
  .meta-top{font-size:12px; color:#bbb; margin-top:8px;}
  .clock{font-size:90px; margin:10px 0;}
  .phase{font-size:24px; margin:6px 0;}
  .pause-label{font-size:20px; margin:4px 0; color:var(--nums-pause);}
  .controls{margin-top:10px;}
  .btn{font-size:20px; padding:10px 20px; margin:4px; opacity:.6;}
  .hint{font-size:12px; color:#aaa; margin-top:4px;}
  .footer{position:fixed; bottom:0; left:0; right:0;
          font-size:12px; padding:6px; background:rgba(0,0,0,.4);}
  .fab{
    position:fixed; bottom:70px; left:20px; width:48px; height:48px;
    border-radius:50%; background:var(--fab); z-index:11;
  }
  .hidden .controls, .hidden .hint{display:none;}
  .page{min-height:100vh; display:flex; flex-direction:column;
        align-items:center; justify-content:center; padding:20px;}
  .instructions{font-size:18px; max-width:600px;}
</style>
</head>
<body>
<div class="progress-full" id="progress"></div>
<div class="rep-btn" id="repBtn">Rep 1</div>

<div class="page main" id="mainPage">
  <div class="meta-top">Work: 01:00 &nbsp; Rest: 00:20</div>
  <div class="clock" id="clock">01:00</div>
  <div class="phase" id="phase">Work</div>
  <div class="pause-label" id="pauseLabel" style="display:none;">Pause</div>
  <div class="controls" id="controls">
    <button class="btn" id="startBtn">▶ Start / Pause</button>
    <button class="btn" id="resetBtn">⏹ Reset</button>
  </div>
  <div class="hint" id="hint">Swipe left for instructions →</div>
</div>

<div class="page" id="instructionsPage" style="display:none;">
  <div class="instructions">
    <h2>How it works</h2>
    <p>• Tap anywhere to Start / Pause / Resume.<br>
       • Double tap → Restart current phase.<br>
       • Triple tap → Next phase.<br>
       • Blue ball toggles controls.<br>
       • Swipe up or down also toggles blue ball mode.<br>
       • Rep button (top-right) lets you check repetition number.</p>
  </div>
</div>

<div class="fab" id="fab"></div>
<div class="footer">Jimmy James - 17.08.2025 - 11:55 - v. 1.08</div>

<script>
let work=60, rest=20;
let phase='work', rep=1;
let running=false, start=0, elapsed=0;
let raf=null, taps=0, tapTimer=null;
let blueMode=false, showingInstructions=false;

const clockEl=document.getElementById('clock');
const phaseEl=document.getElementById('phase');
const progress=document.getElementById('progress');
const repBtn=document.getElementById('repBtn');
const startBtn=document.getElementById('startBtn');
const resetBtn=document.getElementById('resetBtn');
const pauseLabel=document.getElementById('pauseLabel');
const mainPage=document.getElementById('mainPage');
const instrPage=document.getElementById('instructionsPage');
const hint=document.getElementById('hint');

function fmt(s){let m=Math.floor(s/60), ss=s%60;
 return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0');}

function update(){
  let total=phase==='work'?work:rest;
  let left=Math.max(0,total-Math.floor(elapsed));
  clockEl.textContent=fmt(left);
  phaseEl.textContent=phase==='work'?'Work':'Rest';
  repBtn.textContent='Rep '+rep;
  if(running){
    pauseLabel.style.display='none';
    document.body.style.background=phase==='work'?'var(--bg-work)':'var(--bg-rest)';
  } else {
    pauseLabel.style.display='block';
    document.body.style.background='var(--bg-pause)';
  }
  if(phase==='work'){
    clockEl.style.color='var(--letters-work)';
    progress.style.background='linear-gradient(to top,var(--work1),var(--work2))';
  } else {
    clockEl.style.color='var(--nums-rest)';
    progress.style.background='linear-gradient(to top,var(--rest1),var(--rest2))';
  }
  if(!running) clockEl.style.color='var(--nums-pause)';
  let frac=left/(total||1);
  progress.style.height=(Math.max(6,frac*100))+'vh';
}
function loop(){
  if(!running) return;
  elapsed=(Date.now()-start)/1000;
  let total=phase==='work'?work:rest;
  if(elapsed>=total){ nextPhase(); }
  update(); raf=requestAnimationFrame(loop);
}
function toggle(){running?pause():start();}
function start(){running=true; start=Date.now()-elapsed*1000; loop();}
function pause(){running=false; if(raf) cancelAnimationFrame(raf); update();}
function nextPhase(){phase=phase==='work'?'rest':'work'; if(phase==='work') rep++; elapsed=0; start=Date.now(); update();}
function restartPhase(){elapsed=0; start=Date.now(); update();}
function triple(){nextPhase();}
function handleTap(){
  taps++; if(tapTimer) clearTimeout(tapTimer);
  tapTimer=setTimeout(()=>{
    if(taps===1) toggle();
    if(taps===2) restartPhase();
    if(taps===3) triple();
    taps=0;
  },300);
}

document.body.addEventListener('click',e=>{
  if(e.target.closest('.btn')||e.target.closest('.fab')||e.target.closest('.rep-btn')) return;
  handleTap();
});

startBtn.onclick=toggle;
resetBtn.onclick=()=>restartPhase();
repBtn.onclick=()=>rep++;
update();

// swipe detection
let startX=0,startY=0;
document.addEventListener('touchstart',e=>{
  startX=e.touches[0].clientX; startY=e.touches[0].clientY;
});
document.addEventListener('touchend',e=>{
  let dx=e.changedTouches[0].clientX-startX;
  let dy=e.changedTouches[0].clientY-startY;
  if(Math.abs(dx)>50 && dx<0){mainPage.style.display='none'; instrPage.style.display='flex';}
  if(Math.abs(dx)>50 && dx>0){mainPage.style.display='flex'; instrPage.style.display='none';}
  if(Math.abs(dy)>50){toggleBlue();}
});
function toggleBlue(){
  blueMode=!blueMode;
  mainPage.classList.toggle('hidden',blueMode);
  hint.style.display=blueMode?'none':'block';
}
document.getElementById('fab').onclick=toggleBlue;
</script>
</body>
</html>
